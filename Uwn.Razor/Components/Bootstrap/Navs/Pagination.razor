@namespace Uwn.Razor.Components.Bootstrap.Navs
@using Uwn.Razor.Models.ViewModels.Bootstrap.Navs
@inherits UwnComponentBase<PaginationViewModel>

@if (ViewModel.IsVisible)
{
	<nav>
		<ul id="@ViewModel.Id" class="pagination @ViewModel.AdditionalClassNames">
			<li class="page-item @GoBackClass">
				<a class="page-link" style="cursor: pointer;" @onclick="(() => ViewModel.OnPageSelected.InvokeAsync(ViewModel.CurrentPage - 1))">&laquo;</a>
			</li>
			@{
				var lastCellWasEmpty = false;
				for (var page = 1; page <= ViewModel.NumberOfPages; page++)
				{
					var pageNumber = page;
					var activeClass = page == ViewModel.CurrentPage ? "active" : string.Empty;
					<li class="page-item @activeClass">
						@if (ViewModel.NumberOfPages <= ViewModel.MaximumNumberOfLinks || page <= 3 || page > (ViewModel.NumberOfPages - 3) || (page >= ViewModel.CurrentPage - 1 && page <= ViewModel.CurrentPage + 1))
						{
							lastCellWasEmpty = false;
							<a class="page-link" style="cursor: pointer;" @onclick="(() => ViewModel.OnPageSelected.InvokeAsync(pageNumber))">@pageNumber</a>
						}
						else if (!lastCellWasEmpty)
						{
							lastCellWasEmpty = true;
							<a class="page-link disabled">...</a>
						}
					</li>
				}
			}
			<li class="page-item @GoForwardClass">
				<a class="page-link" style="cursor:pointer;" @onclick="(() => ViewModel.OnPageSelected.InvokeAsync(ViewModel.CurrentPage + 1))">&raquo;</a>
			</li>
		</ul>
	</nav>
}

@code {
	[Parameter] public int CurrentPage { get; set; } = 1;
	[Parameter] public int NumberOfPages { get; set; }
	[Parameter] public int MaximumNumberOfLinks { get; set; } = 11;
	[Parameter] public EventCallback<int> OnPageSelected { get; set; }

	public bool CanGoBack => ViewModel.CurrentPage > 1;
	public bool CanGoForward => ViewModel.CurrentPage < ViewModel.NumberOfPages;

	public string GoBackClass => CanGoBack ? string.Empty : "disabled";
	public string GoForwardClass => CanGoForward ? string.Empty : "disabled";

	protected override PaginationViewModel BuildViewModelFromParameters()
		=> new()
		{
			CurrentPage = CurrentPage,
			MaximumNumberOfLinks = MaximumNumberOfLinks,
			NumberOfPages = NumberOfPages,
			OnPageSelected = OnPageSelected
		};
}